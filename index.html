<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TIMU | 生產管理系統</title>
    <style>
        /* 延續簡約設計 */
        body { font-family: sans-serif; background: #f9f8f6; color: #333; padding: 20px; }
        .card { background: white; max-width: 600px; margin: auto; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab { display: none; }
        .active { display: block; }
        .nav { text-align: center; margin-bottom: 20px; }
        button { background: #333; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
        input, select { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; }
        .order-item { border-bottom: 1px solid #eee; padding: 10px 0; }
    </style>
</head>
<body>

<div class="nav">
    <button onclick="showTab('form')">填寫新單</button>
    <button onclick="showTab('admin'); loadOrders();">進度管理</button>
</div>

<div id="formTab" class="tab active card">
    <h2>建立新訂單</h2>
    <input type="text" id="orderId" placeholder="訂單編號">
    <input type="date" id="deadline" placeholder="預計交期">
    
    <p>款式 1</p>
    <select id="style1"></select>
    <input type="text" id="color1" placeholder="顏色">
    <input type="text" id="size1" placeholder="尺寸">

    <p>款式 2</p>
    <select id="style2"></select>
    <input type="text" id="color2" placeholder="顏色">
    <input type="text" id="size2" placeholder="尺寸">
    
    <button onclick="submitOrder()" style="width:100%">送出資料</button>
</div>

<div id="adminTab" class="tab card">
    <h2>進度追蹤與修改</h2>
    <div id="orderList">載入中...</div>
</div>

<script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycby9Q4NwRye6sDyFaq_ogKnvDSVJUUMGO_U7t65hGDk6rHQMKxyQFmkUFe8VXHm0XqTmJg/exec"; // 貼上剛才部署的網址

    function showTab(type) {
        document.getElementById('formTab').className = type === 'form' ? 'tab active card' : 'tab card';
        document.getElementById('adminTab').className = type === 'admin' ? 'tab active card' : 'tab card';
    }

    // 初始化：讀取試算表中的款式下拉選單
    window.onload = function() {
        google.script.run.withSuccessHandler(styles => {
            const selects = [document.getElementById('style1'), document.getElementById('style2')];
            selects.forEach(s => {
                styles.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item[0]; opt.text = item[0];
                    s.appendChild(opt);
                });
            });
        }).getStyles();
    };

    function submitOrder() {
        const data = {
            id: document.getElementById('orderId').value,
            deadline: document.getElementById('deadline').value,
            s1: document.getElementById('style1').value,
            c1: document.getElementById('color1').value,
            z1: document.getElementById('size1').value,
            s2: document.getElementById('style2').value,
            c2: document.getElementById('color2').value,
            z2: document.getElementById('size2').value
        };
        google.script.run.withSuccessHandler(() => alert('訂單已同步至試算表！')).addOrder(data);
    }

    function loadOrders() {
        google.script.run.withSuccessHandler(data => {
            let html = '';
            for(let i=1; i<data.length; i++) {
                html += `<div class="order-item">
                    <b>${data[i][0]}</b> - ${data[i][3]} (${data[i][9]})<br>
                    <select onchange="updateStatus('${data[i][0]}', this.value)">
                        <option>更改進度</option>
                        <option value="備料中">備料中</option>
                        <option value="車縫中">車縫中</option>
                        <option value="品檢中">品檢中</option>
                        <option value="已完工">已完工</option>
                    </select>
                </div>`;
            }
            document.getElementById('orderList').innerHTML = html;
        }).getOrders();
    }

    function updateStatus(id, status) {
        google.script.run.withSuccessHandler(() => alert('進度已更新')).updateStatus(id, status);
    }
</script>
</body>
</html>
