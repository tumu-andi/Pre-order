<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TIMU | 生產管理系統</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    
    <style>
        body { font-family: sans-serif; background: #f9f8f6; color: #333; padding: 20px; }
        .card { background: white; max-width: 600px; margin: auto; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .nav { text-align: center; margin-bottom: 20px; }
        button { background: #333; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
        input, select { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; }
        /* 讓搜尋選單看起來更符合 TIMU 的極簡感 */
        .choices__inner { background-color: #fff; border: 1px solid #ddd; border-radius: 0; }
        .choices__list--dropdown { border-radius: 0; }
    </style>
</head>
<body>

<div class="nav">
    <button onclick="showTab('form')">填寫新單</button>
    <button onclick="showTab('admin'); loadOrders();">進度管理</button>
</div>

<div id="formTab" class="tab active card">
    <h2>建立新訂單</h2>
    <input type="text" id="orderId" placeholder="訂單編號">
    <input type="date" id="deadline" placeholder="預計交期">
    
    <p>款式 1</p>
    <select id="style1" class="style-select"></select>
    <input type="text" id="color1" placeholder="顏色">
    <input type="text" id="size1" placeholder="尺寸">

    <p>款式 2</p>
    <select id="style2" class="style-select"></select>
    <input type="text" id="color2" placeholder="顏色">
    <input type="text" id="size2" placeholder="尺寸">
    
    <button onclick="submitOrder()" style="width:100%; margin-top: 20px;">送出資料</button>
</div>

<div id="adminTab" class="tab card" style="display:none;">
    <h2>進度追蹤與修改</h2>
    <div id="orderList">載入中...</div>
</div>

<script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbwh-1fS08fb7rsrEs7_BgMVhQoGpE_wc_GUfG6R-C3D3Ds0ytj0GhH5x_MvgYvfQzejFA/exec"; 
    let choice1, choice2; // 儲存搜尋物件

    window.onload = function() {
        fetch(`${scriptUrl}?action=getStyles`)
        .then(res => res.json())
        .then(styles => {
            const selects = [document.getElementById('style1'), document.getElementById('style2')];
            selects.forEach(s => {
                // 加入一個預設選項
                let defaultOpt = document.createElement('option');
                defaultOpt.text = "輸入關鍵字搜尋款式...";
                s.appendChild(defaultOpt);

                styles.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item[0]; opt.text = item[0];
                    s.appendChild(opt);
                });
            });

            // 啟動搜尋功能
            choice1 = new Choices('#style1', { searchEnabled: true, itemSelectText: '' });
            choice2 = new Choices('#style2', { searchEnabled: true, itemSelectText: '' });
        });
    };

    // ... 其餘 submitOrder, loadOrders, updateStatus 函數維持不變 ...
    // ... 記得把上一個回答的 JS 邏輯貼在下面 ...
</script>
</body>
</html>
function submitOrder() {
    const data = {
        id: document.getElementById('orderId').value,
        deadline: document.getElementById('deadline').value,
        s1: document.getElementById('style1').value,
        c1: document.getElementById('color1').value,
        z1: document.getElementById('size1').value,
        s2: document.getElementById('style2').value,
        c2: document.getElementById('color2').value,
        z2: document.getElementById('size2').value
    };
    
    fetch(scriptUrl, {
        method: "POST",
        body: JSON.stringify({action: 'addOrder', data: data})
    }).then(() => alert('訂單已送出！'));
}

function loadOrders() {
    fetch(`${scriptUrl}?action=getOrders`)
    .then(res => res.json())
    .then(data => {
        let html = '';
        for(let i=1; i<data.length; i++) {
            html += `<div class="order-item">
                <b>${data[i][0]}</b> - ${data[i][3]} (${data[i][9]})<br>
                <select onchange="updateStatus('${data[i][0]}', this.value)">
                    <option>更改進度</option>
                    <option value="備料中">備料中</option>
                    <option value="車縫中">車縫中</option>
                    <option value="品檢中">品檢中</option>
                    <option value="已完工">已完工</option>
                </select>
            </div>`;
        }
        document.getElementById('orderList').innerHTML = html;
    });
}

function updateStatus(id, status) {
    fetch(scriptUrl, {
        method: "POST",
        body: JSON.stringify({action: 'updateStatus', id: id, status: status})
    }).then(() => alert('進度已同步回試算表！'));
}
</script>
</body>
</html>
